


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="shortcut icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.4.0">
    
    
      
        <title>Software Defined Storage - IBM Cloud Adoption</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.fe0cca5b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#using-software-defined-storage" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href="../.." title="IBM Cloud Adoption" class="md-header-nav__button md-logo" aria-label="IBM Cloud Adoption">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            IBM Cloud Adoption
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Software Defined Storage
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header-nav__source">
        
<a href="https://github.com/dwakeman/cloud-adoption-ibn" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="IBM Cloud Adoption" class="md-nav__button md-logo" aria-label="IBM Cloud Adoption">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg>

    </a>
    IBM Cloud Adoption
  </label>
  
    <div class="md-nav__source">
      
<a href="https://github.com/dwakeman/cloud-adoption-ibn" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href="../.." title="Home" class="md-nav__link">
      Home
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-2" type="checkbox" id="nav-2">
    
    <label class="md-nav__link" for="nav-2">
      Resilient Applications
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Resilient Applications" data-md-level="1">
      <label class="md-nav__title" for="nav-2">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Resilient Applications
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../ha-app/ha-app/" title="HA app considerations" class="md-nav__link">
      HA app considerations
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ha-app/create-env/" title="Creating the Environment" class="md-nav__link">
      Creating the Environment
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../ha-app/deploy-ha-app/" title="HA app deployment" class="md-nav__link">
      HA app deployment
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-3" type="checkbox" id="nav-3">
    
    <label class="md-nav__link" for="nav-3">
      Disaster Recovery
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Disaster Recovery" data-md-level="1">
      <label class="md-nav__title" for="nav-3">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Disaster Recovery
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../disaster-recovery/disaster-recovery/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-4" type="checkbox" id="nav-4">
    
    <label class="md-nav__link" for="nav-4">
      Custom Domains
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Custom Domains" data-md-level="1">
      <label class="md-nav__title" for="nav-4">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Custom Domains
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-domain/create-domain/" title="Create a domain" class="md-nav__link">
      Create a domain
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-domain/manage-domain/" title="Manage your domain" class="md-nav__link">
      Manage your domain
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../custom-domain/domain-with-openshift/" title="Configure domain for OpenShift" class="md-nav__link">
      Configure domain for OpenShift
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-5" type="checkbox" id="nav-5" checked>
    
    <label class="md-nav__link" for="nav-5">
      Infrastructure
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Infrastructure" data-md-level="1">
      <label class="md-nav__title" for="nav-5">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Infrastructure
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../iac/" title="Infrastructure as Code (IaC)" class="md-nav__link">
      Infrastructure as Code (IaC)
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../schematics/" title="Schematics" class="md-nav__link">
      Schematics
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../vpc/" title="Virtual Private Cloud" class="md-nav__link">
      Virtual Private Cloud
    </a>
  </li>

        
          
          
          

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Software Defined Storage
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Software Defined Storage" class="md-nav__link md-nav__link--active">
      Software Defined Storage
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparing-for-portworx" class="md-nav__link">
    Preparing for Portworx
  </a>
  
    <nav class="md-nav" aria-label="Preparing for Portworx">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-block-storage" class="md-nav__link">
    Creating block storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attaching-block-storage-to-worker-nodes" class="md-nav__link">
    Attaching block storage to worker nodes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-the-image-pull-secrets" class="md-nav__link">
    Copy the image pull secrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#store-the-pull-secret-in-the-service-account" class="md-nav__link">
    Store the pull secret in the service account
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-6" type="checkbox" id="nav-6">
    
    <label class="md-nav__link" for="nav-6">
      IBM Cloud Platform
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="IBM Cloud Platform" data-md-level="1">
      <label class="md-nav__title" for="nav-6">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        IBM Cloud Platform
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud-platform/openshift-ibm-cloud/" title="OpenShift on IBM Cloud" class="md-nav__link">
      OpenShift on IBM Cloud
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud-platform/ibm-cloud-operator/" title="IBM Cloud Operator" class="md-nav__link">
      IBM Cloud Operator
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../cloud-platform/key-protect/" title="Key Protect" class="md-nav__link">
      Key Protect
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-7" type="checkbox" id="nav-7">
    
    <label class="md-nav__link" for="nav-7">
      Hybrid Cloud
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Hybrid Cloud" data-md-level="1">
      <label class="md-nav__title" for="nav-7">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Hybrid Cloud
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../hybrid-cloud/hybrid/" title="Deploying a Hybrid Cloud Application" class="md-nav__link">
      Deploying a Hybrid Cloud Application
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      Developer Experience
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M8.59 16.58L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.42z"/></svg>
      </span>
    </label>
    <nav class="md-nav" aria-label="Developer Experience" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
        </span>
        Developer Experience
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev-tools/dev-experience/" title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../../dev-tools/crw/" title="CodeReady Workspaces" class="md-nav__link">
      CodeReady Workspaces
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#preparing-for-portworx" class="md-nav__link">
    Preparing for Portworx
  </a>
  
    <nav class="md-nav" aria-label="Preparing for Portworx">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#creating-block-storage" class="md-nav__link">
    Creating block storage
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#attaching-block-storage-to-worker-nodes" class="md-nav__link">
    Attaching block storage to worker nodes
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#copy-the-image-pull-secrets" class="md-nav__link">
    Copy the image pull secrets
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#store-the-pull-secret-in-the-service-account" class="md-nav__link">
    Store the pull secret in the service account
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  
                
                
                <h1 id="using-software-defined-storage">Using Software Defined Storage</h1>
<p>There are many types of Software Defined Storage (SDS) implementations in the market, and they may apply with different types of compute technology.  The purpose of this section is to document how to install and configure <a href="https://cloud.ibm.com/catalog/services/portworx-enterprise">Portworx Enterprise</a> with <a href="https://cloud.ibm.com/kubernetes/catalog/create?platformType=openshift">OpenShift on IBM Cloud</a>.  Portworx acts as a storage layer in kubernetes that sits on top of some underlying physical storage attached to the worker nodes in the cluster.  It also provides additional storage classes for creating persistent volumes in Portworx.   Additional information on using Portworx with OpenShift on IBM Cloud can be found in the <a href="https://cloud.ibm.com/docs/openshift?topic=openshift-portworx">documentation</a>.</p>
<p><em><strong>Note:</strong> These instructions were tested with OpenShift 4.5.13 running in <a href="https://cloud.ibm.com/vpc-ext/overview">Virtual Private Cloud</a> and assume that you already have an OpenShift cluster provisioned.</em></p>
<h2 id="preparing-for-portworx">Preparing for Portworx</h2>
<p>Review the documentation for <a href="https://cloud.ibm.com/docs/openshift?topic=openshift-portworx#portworx_planning">Planning your Portworx setup</a> to verify that your existing cluster meets the requirements.  If not, create a new cluster.</p>
<p><em><strong>Note:</strong> It would appear that the provisioning page for Portworx in the IBM Cloud Catalog does some sort of requirements checking after you supply an API key.  It did not recognize my cluster when it had <code>bx2.8x32</code> nodes, but id did when I added <code>bx2.16x64</code> nodes.</em></p>
<p>There are two common topologies for adding SDS to your cluster.  The first one is called <code>hyper-converged</code>, where every worker node in the cluster has attached storage for Portworx.  This is the topology with the best performance, but it requires you to have storage attached to every worker node.</p>
<p>The other topology is called <code>storage-heavy</code>; in this topology only some of the worker nodes have attached storage.  Portworx will still make the storage available to pods running on any worker node in the cluster, but for pods running on non-SDS nodes the storage access requests will be routed on the private network to one of the SDS nodes.  </p>
<p><em><strong>Note:</strong> As far as I can tell the installation and configuration of Portworx is the same either way, but that may not be true.  For purposes of this exercise I have created an OpenShift cluster with 3 worker nodes in <code>US South</code>, with one worker node in each zone.</em></p>
<h3 id="creating-block-storage">Creating block storage</h3>
<p>Your worker nodes will need to have block storage volumes attached to them in order for Portworx to work.  See the <a href="https://cloud.ibm.com/docs/openshift?topic=openshift-portworx#portworx_planning">documentation</a> for more details.  Since these instuctions are for a cluster in VPC, follow these steps to create and attach the block storage volumes to your worker nodes.  Documentation can also be found <a href="https://cloud.ibm.com/docs/openshift?topic=openshift-utilities#vpc_api_attach">here</a>.</p>
<p>You can create the block storage volumes using the <a href="https://cloud.ibm.com/vpc-ext/storage/storageVolumes">IBM Cloud UI</a>.  Make sure to create the block storage volume in the same Availability zone as the worker node to which you want to attach it.  For visibility purposes, you should consider a naming convention that will help you determine where the storage volumes are being used.  In this example the name of the storage volume includes the <code>worker ID</code> of the worker node to which it will be attached.</p>
<p>If you don't want to look up the worker nodes in the UI you can run this command to get a list of your worker nodes:</p>
<p><code>ic oc worker ls -c &lt;cluster-name&gt;</code></p>
<p>The output should look like this:</p>
<pre><code>OK
ID                                                    Primary IP    Flavor     State    Status   Zone         Version   
kube-bu6rbsid0j80c74a6u2g-sbxocp11-default-00000162   10.1.128.12   bx2.8x32   normal   Ready    us-south-3   4.5.13_1515_openshift   
kube-bu6rbsid0j80c74a6u2g-sbxocp11-default-00000209   10.1.120.6    bx2.8x32   normal   Ready    us-south-2   4.5.13_1515_openshift   
kube-bu6rbsid0j80c74a6u2g-sbxocp11-default-00000386   10.1.112.17   bx2.8x32   normal   Ready    us-south-1   4.5.13_1515_openshift
</code></pre>

<p><em><strong>Note:</strong> As you create each storage volume, take note of it's <code>volume ID</code>.  You will need it in the next step.</em></p>
<h3 id="attaching-block-storage-to-worker-nodes">Attaching block storage to worker nodes</h3>
<p>In order for Portworx to work it needs the storage volumes created above to be attached to the worker nodes.  The <a href="https://cloud.ibm.com/docs/openshift?topic=openshift-utilities#vpc_api_attach">documentation</a> was used to derive these instructions.</p>
<p>Make sure you are logged into the IBM Cloud CLI.</p>
<p>Run this command to fetch your oauth token and store it in an environment variable:</p>
<p><code>export iamtoken=$(ibmcloud iam oauth-tokens)</code>  &lt;--- This does not work right!!  Need to figure out the right command.</p>
<p>In this example the cluster was created in <code>US South</code>, with worker nodes in <code>us-south-</code>, <code>us-south-2</code> and <code>us-south-3</code>.  Block storage volumes of equal size were also created in those three zones.</p>
<p>Since worker nodes are not visible in the IBM Cloud portal we cannot attach the storage using normal methods in the UI or CLI.  In order to attach the volumes to the worker nodes we have to use the IKS API.  The format of the API call looks like this:</p>
<pre><code> curl -X POST -H &quot;Authorization: $iamtoken&quot; &quot;https://&lt;region&gt;.containers.cloud.ibm.com/v2/storage/vpc/createAttachment?cluster=&lt;cluster_ID&gt;&amp;worker=&lt;worker_ID&gt;&amp;volumeID=&lt;volume_ID&gt;&quot;
</code></pre>

<p>Use this command to get your worker IDs:</p>
<pre><code>ic oc worker ls -c &lt;cluster-name&gt;
</code></pre>

<p>The output should look like this:</p>
<pre><code>OK
ID                                                    Primary IP    Flavor     State    Status   Zone         Version   
kube-bu6rbsid0j80c74a6u2g-sbxocp11-default-00000162   10.1.128.12   bx2.8x32   normal   Ready    us-south-3   4.5.13_1515_openshift   
kube-bu6rbsid0j80c74a6u2g-sbxocp11-default-00000209   10.1.120.6    bx2.8x32   normal   Ready    us-south-2   4.5.13_1515_openshift   
kube-bu6rbsid0j80c74a6u2g-sbxocp11-default-00000386   10.1.112.17   bx2.8x32   normal   Ready    us-south-1   4.5.13_1515_openshift
</code></pre>

<p>The volume IDs should have been collected above when you created the volumes.  If not, you can get them from the UI.</p>
<p><em><strong>Note:</strong> Make sure to update this section with a CLI command to get the volumes!</em></p>
<p>Run the cURL command above for each worker node and volume.  For example:</p>
<pre><code>curl -X POST -H &quot;Authorization: $iamtoken&quot; &quot;https://us-south.containers.cloud.ibm.com/v2/storage/vpc/createAttachment?cluster=bu6rbsid0j80c74a6u2g&amp;worker=kube-bu6rbsid0j80c74a6u2g-sbxocp11-default-00000386&amp;volumeID=r006-0be0c31c-3d1f-4931-bc4e-c554b4d3fa58&quot;
</code></pre>

<p>The output should look like this:</p>
<pre><code class="json">{&quot;id&quot;:&quot;0717-85669abb-a268-4fff-95ca-5c8ae953af0e&quot;,&quot;volume&quot;:{&quot;name&quot;:&quot;px-kube-bu6rbsid0j80c74a6u2g-sbxocp11-default-00000386&quot;,&quot;id&quot;:&quot;r006-0be0c31c-3d1f-4931-bc4e-c554b4d3fa58&quot;},&quot;device&quot;:{&quot;id&quot;:&quot;&quot;},&quot;name&quot;:&quot;volume-attachment&quot;,&quot;status&quot;:&quot;attaching&quot;,&quot;type&quot;:&quot;data&quot;}
</code></pre>

<p>To review the volume attachments for a worker node you can run this command:</p>
<pre><code>curl -X GET -H &quot;Authorization: &lt;IAM_token&gt;&quot; -H &quot;Content-Type: application/json&quot; -H &quot;X-Auth-Resource-Group-ID: &lt;resource_group_ID&gt;&quot; &quot;https://&lt;region&gt;.containers.cloud.ibm.com/v2/storage/clusters/&lt;cluster_ID&gt;/workers/&lt;worker_ID&gt;/volume_attachments&quot;
</code></pre>

<p>For example:</p>
<pre><code>curl -X GET -H &quot;Authorization: $iamtoken&quot; -H &quot;Content-Type: application/json&quot; -H &quot;X-Auth-Resource-Group-ID: 5e6a2492dd9249659469ea51da471197&quot; &quot;https://us-south.containers.cloud.ibm.com/v2/storage/vpc/getAttachmentsList?cluster=bu6rbsid0j80c74a6u2g&amp;worker=kube-bu6rbsid0j80c74a6u2g-sbxocp11-default-00000386&quot;
</code></pre>

<p>The output should look like this:</p>
<pre><code class="json">{&quot;volume_attachments&quot;:[{&quot;id&quot;:&quot;0717-85669abb-a268-4fff-95ca-5c8ae953af0e&quot;,&quot;volume&quot;:{&quot;name&quot;:&quot;px-kube-bu6rbsid0j80c74a6u2g-sbxocp11-default-00000386&quot;,&quot;id&quot;:&quot;r006-0be0c31c-3d1f-4931-bc4e-c554b4d3fa58&quot;},&quot;device&quot;:{&quot;id&quot;:&quot;0717-85669abb-a268-4fff-95ca-5c8ae953af0e-9nh8x&quot;},&quot;name&quot;:&quot;volume-attachment&quot;,&quot;status&quot;:&quot;attached&quot;,&quot;type&quot;:&quot;data&quot;},{&quot;id&quot;:&quot;0717-6acdae87-58cd-4a05-acfa-b178c3544c31&quot;,&quot;volume&quot;:{&quot;name&quot;:&quot;hypnotist-freezing-willow-display&quot;,&quot;id&quot;:&quot;r006-a354ecea-4cc3-4445-9431-12cd9ce569a8&quot;},&quot;device&quot;:{&quot;id&quot;:&quot;0717-6acdae87-58cd-4a05-acfa-b178c3544c31-fzd6s&quot;},&quot;name&quot;:&quot;volume-attachment&quot;,&quot;status&quot;:&quot;attached&quot;,&quot;type&quot;:&quot;boot&quot;}]}
</code></pre>

<p>Provision an instance of <a href="https://cloud.ibm.com/catalog/services/databases-for-etcd">Databases for Etcd</a> in the same resource group as the OpenShift cluster.  For visibility purposes, consider a naming convention that includes the cluster name, such as <code>px-sbx-ocp-11</code>, and add a tag with the name of the cluster as well.  Review the <a href="https://cloud.ibm.com/docs/openshift?topic=openshift-portworx#databases-for-etcd">documentation</a> for more infomration on configuration options.</p>
<p>Follow the steps in the documentation.</p>
<p>When it comes to encoding the username and password, I found that the instructions did not work, as they added the <code>-n</code> from the command into the output.  I used this command:</p>
<pre><code>echo &quot;&lt;the username or password&gt;&quot; | base64
</code></pre>

<p>At this point the Databases for Etcd instance is created, the username and password have been encoded and the secret has been created.</p>
<p>Now we need to <a href="https://cloud.ibm.com/docs/openshift?topic=openshift-registry#copy_imagePullSecret">copy the image pull secrets</a> and <a href="https://cloud.ibm.com/docs/openshift?topic=openshift-registry#store_imagePullSecret">add them to the service account</a>.</p>
<h3 id="copy-the-image-pull-secrets">Copy the image pull secrets</h3>
<p>To list the secrets in the <code>default</code> namespace:</p>
<pre><code>oc get secrets -n default | grep icr-io
</code></pre>

<p>The output should look like this:</p>
<pre><code>all-icr-io                 kubernetes.io/dockerconfigjson        1         115m
</code></pre>

<p>To copy the <code>all-icr-io</code> secret to the <code>kube-system</code> namespace:</p>
<pre><code>oc get secret all-icr-io -n default -o yaml | sed 's/default/kube-system/g' | oc create -n kube-system -f -
</code></pre>

<p>The output should look like this:</p>
<pre><code>secret/all-icr-io created
</code></pre>

<h3 id="store-the-pull-secret-in-the-service-account">Store the pull secret in the service account</h3>
<p>Check if the image pull secret already exists for the default service account:</p>
<pre><code>oc describe serviceaccount default -n kube-system
</code></pre>

<p>The output should look like this:</p>
<pre><code>Name:                default
Namespace:           kube-system
Labels:              &lt;none&gt;
Annotations:         &lt;none&gt;
Image pull secrets:  default-dockercfg-bkxjw
Mountable secrets:   default-token-fbhwh
                     default-dockercfg-bkxjw
Tokens:              default-token-fbhwh
                     default-token-wsnrg
Events:              &lt;none&gt;
</code></pre>

<p>Notice that the <code>Image pull secrets</code> sction only lists <code>default-dockercfg-bkxjw</code>.  This means that the image pull secrets are already defined, but do not yet contain <code>all-icr-io</code>.  </p>
<p>Run this command to add it:</p>
<pre><code>oc patch -n kube-system serviceaccount/default --type='json' -p='[{&quot;op&quot;:&quot;add&quot;,&quot;path&quot;:&quot;/imagePullSecrets/-&quot;,&quot;value&quot;:{&quot;name&quot;:&quot;all-icr-io&quot;}}]'
</code></pre>

<p>The output should look like this:</p>
<pre><code>serviceaccount/default patched
</code></pre>

<p>You can verify that it worked using this command:</p>
<pre><code>oc describe serviceaccount default -n kube-system
</code></pre>

<p>The output should look like this:</p>
<pre><code>Name:                default
Namespace:           kube-system
Labels:              &lt;none&gt;
Annotations:         &lt;none&gt;
Image pull secrets:  default-dockercfg-bkxjw
                     all-icr-io
Mountable secrets:   default-token-fbhwh
                     default-dockercfg-bkxjw
Tokens:              default-token-fbhwh
                     default-token-wsnrg
Events:              &lt;none&gt;
</code></pre>

<p>Notice that now <code>all-icr-io</code> shows up in the <code>Image pull secrets</code> section.</p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../vpc/" title="Virtual Private Cloud" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Virtual Private Cloud
              </div>
            </div>
          </a>
        
        
          <a href="../../cloud-platform/openshift-ibm-cloud/" title="OpenShift on IBM Cloud" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                OpenShift on IBM Cloud
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../../assets/javascripts/bundle.b39636ac.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "../..",
          features: [],
          search: Object.assign({
            worker: "../../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>